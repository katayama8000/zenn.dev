---
title: "DI(Dependency Injection)ã®ãƒ¡ãƒªãƒƒãƒˆã‚’ç†è§£ã™ã‚‹"
emoji: "ğŸ¦"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["NestJS", "Angular", "TypeScript", "DI"]
published: true
---

# DI(Dependency Injection)ã¨ã¯

NestJS ã‚„ Angular ã§ã‚ˆãè€³ã«ã™ã‚‹ DI ã¨ã¯ä¾å­˜æ€§ã®æ³¨å…¥ã®ã“ã¨ã§ã™ã€‚
ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯æ›¸ã„ã¦ã‚ã‚Šã¾ã™ãŒã€ãªã‚“ã®ã“ã¨ã‹ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚

```ts
// test1.service.ts
@Injectable()
export class Test1Service {
  getName() {
    return { name: "john" };
  }
}
```

```ts
// test1.controller.ts
@Controller("test1")
export class Test1Controller {
  constructor(private readonly test1Service: Test1Service) {}

  @Get()
  getName() {
    return this.test1Service.getName();
  }
}
```

Nest CLI ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ãŸã¨ãã«ç”Ÿæˆã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰ã¯ã“ã‚“ãªæ„Ÿã˜ã«ãªã£ã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ã€‚
service ã§ã®å‡¦ç†ã‚’ controller ã§å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¦ã„ã‚‹ãã‚‰ã„ã«ã—ã‹æ€ã„ã¾ã›ã‚“ã€‚

ã“ã®ã‚µãƒ¼ãƒ“ã‚¹ã¯å¿…ãšã—ã‚‚ã€DI ã—ãªã„ã¨ä½¿ãˆãªã„ã‚ã‘ã§ã¯ãªãã€é€šå¸¸ã®ã‚¯ãƒ©ã‚¹ãªã®ã§ã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã™ã‚Œã°ä½¿ãˆã¾ã™ã€‚

```ts
// test1.controller.ts
@Controller("test1")
export class Test1Controller {
  private readonly test1Service = new Test1Service();

  @Get()
  getName() {
    return this.test1Service.getName();
  }
}
```

# DI ã®ãƒ¡ãƒªãƒƒãƒˆ

## 1. ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ãŒä¸€åº¦ã ã‘ã§æ¸ˆã‚€

ã‚¯ãƒ©ã‚¹ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã™ã‚‹ã¨ã€ãã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ã„ãŸã„æ™‚ã«æ¯å›ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

è©¦ã—ã«ã€ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ¼ã« `console.log` ã‚’å…¥ã‚Œã¦ã¿ã¾ã™ã€‚

```ts
// test1.service.ts
@Injectable()
export class Test1Service {
  constructor() {
    console.log("ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã•ã‚Œã¾ã—ãŸ");
  }

  getName() {
    return { name: "john" };
  }
}
```

DI ã‚’ä½¿ã‚ãªã„å ´åˆã€service class ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã™ã‚‹ãŸã³ã«ã€`ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã•ã‚Œã¾ã—ãŸ` ã¨è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

ä¸€æ–¹ã€DI ã‚’ä½¿ã†å ´åˆã€DI ã•ã‚ŒãŸ service class ã¯ä¸€åº¦ã ã‘ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã•ã‚Œã¾ã™ã€‚
app.module.ts ã® `providers` ã« service ã‚’ç™»éŒ²ã—ã€èª­ã¿è¾¼ã¿æ™‚ã«ä¸€åº¦ã ã‘ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã•ã‚Œã¾ã™ã€‚

```ts
// app.module.ts
@Module({
  imports: [],
  controllers: [AppController, Test1Controller],
  providers: [AppService, Test1Service],
})
export class AppModule {}
```

## 2. ä¾å­˜é–¢ä¿‚ã®è§£æ±ºãŒè‡ªå‹•ã§è¡Œã‚ã‚Œã‚‹

`test1.service.ts` ã®ä¸­ã§ã€`test2.service.ts` ã‚’å‘¼ã³å‡ºã™ã¨ã—ã¾ã™ã€‚
ãã—ã¦,`test1.controller.ts`ã§`getAge()`ã‚’å‘¼ã³å‡ºã™ã¨ã—ã¾ã™ã€‚

### 2-1. DI ã‚’ä½¿ã‚ãªã„å ´åˆ

```ts
// test1.service.ts
@Injectable()
export class Test1Service {
  constructor(private readonly test2Service: Test2Service) {}

  getName() {
    return { name: "john" };
  }

  getAge() {
    return this.test2Service.getAge();
  }
}

// test2.service.ts
@Injectable()
export class Test2Service {
  getAge() {
    return { age: 20 };
  }
}

// test1.controller.ts
@Controller("test1")
export class Test1Controller {
  @Get("age")
  getAge() {
    return new Test1Service(new Test2Service()).getAge();
  }
}
```

`Test1Service`ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã—ã¦ã€
`Test1Service`ã«ä¾å­˜ã—ã¦ã„ã‚‹`Test2Service`ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã—ã¦ã„ã¾ã™ã€‚

ã“ã‚ŒãŒã€å¢—ãˆã‚Œã°å¢—ãˆã‚‹ã»ã©ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒè¤‡é›‘ã«ãªã£ã¦ã„ãå¯èª­æ€§ãŒè½ã¡ã¾ã™ã€‚
ã¾ãŸãƒ¡ãƒ¢ãƒªã®ç„¡é§„ãªä½¿ç”¨ã«ã‚‚ã¤ãªãŒã‚Šã¾ã™ã€‚

### 2-2. DI ã‚’ä½¿ã†å ´åˆ

```ts
// test1.service.ts
çœç•¥;
// test2.service.ts
çœç•¥;

// test1.controller.ts
@Controller("test1")
export class Test1Controller {
  constructor(private readonly test1Service: Test1Service) {}

  @Get("age")
  getAge() {
    return this.test1Service.getAge();
  }
}
```

`test1.service.ts` ã‚’ constructor ã«ç™»éŒ²ã™ã‚‹ã ã‘ã§ã€ `test1.service.ts` ãŒä¾å­˜ã—ã¦ã„ã‚‹ `test2.service.ts` ã¸ã®ä¾å­˜é–¢ä¿‚ã‚‚è§£æ±ºã—ã¦ãã‚Œã¾ã™ã€‚
