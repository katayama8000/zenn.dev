---
title: "jotaiã®è¶…å…¥é–€(firebaseAuth ã‚’ jotaiã§ç®¡ç†ã™ã‚‹)"
emoji: "ğŸ¦"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["jotai", "firebase", "react", "nextjs", "typescript"]
published: false
---

# jotai ã¨ã¯

https://jotai.org/

jotai ã¨ã¯ã€react ã®çŠ¶æ…‹ç®¡ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚ãƒ•ãƒƒã‚¯ã‚¹ãƒ©ã‚¤ã‚¯ã«çŠ¶æ…‹ã‚’ç®¡ç†ã§ãã€å­¦ç¿’ã‚³ã‚¹ãƒˆã‚‚ä½ã„ã®ã§ã€ãŠæ‰‹è»½ã«çŠ¶æ…‹ç®¡ç†ã‚’å®Ÿè£…ã§ãã¾ã™ã€‚

ã¾ãŸã€recoil ã«éå¸¸ã«è‰¯ãä¼¼ã¦ãŠã‚Šã€recoil ã‚’ä½¿ã£ãŸã“ã¨ãŒã‚ã‚‹äººã«ã¯ã€ã™ãã«ä½¿ã„ã“ãªã›ã‚‹ã¨æ€ã„ã¾ã™ã€‚

:::message
é–‹ç™ºè€…ã®æ–¹ã®è¨˜äº‹ã«ã¯ recoil äº’æ›ã¨è¨£åˆ¥ã™ã‚‹æ–¹å‘ã«é–‹ç™ºãŒé€²ã¿ãã†ãªã“ã¨ãŒæ›¸ã„ã¦ã‚ã‚Šã¾ã™ã€‚
https://zenn.dev/dai_shi/articles/e6bfe15f6eabc3
:::

# ä»Šå›ã®å®Ÿè£…ã™ã‚‹å†…å®¹

ä»Šå›ã¯ jotai ã‚’ä½¿ã£ã¦ã€firebaseAuth ã‚’ç®¡ç†ã—ã€æ›¸ãå‘³ã‚’è©¦ã—ã¦ã¿ã‚‹è¶£æ—¨ã§ã™ã€‚

- firebase ã§ãƒ­ã‚°ã‚¤ãƒ³
- ãƒ¦ãƒ¼ã‚¶ãƒ¼çŠ¶æ…‹ã‚’æ›´æ–°
- ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å¤‰æ›´
- firebase ã§ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
- ãƒ¦ãƒ¼ã‚¶ãƒ¼çŠ¶æ…‹ã‚’æ›´æ–°
- ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å¤‰æ›´

ä¸Šè¨˜ã‚’å®Ÿè£…ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

â€» firebase ã®è§£èª¬ã¯å‰²æ„›ã—ã¾ã™ã€‚

# å®Ÿè£…

## æº–å‚™

![ãƒ­ã‚°ã‚¢ã‚¦ãƒˆçŠ¶æ…‹](/images/jotai-firebase/logoutUI.png)

ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ãªã„ã¨èƒŒæ™¯ãŒèµ¤ãéå¸¸ã«ã‚¹ãƒˆãƒ¬ã‚¹ãƒ•ãƒ«ãª UI ã«ãªã£ã¦ã„ã¾ã™ã€‚

:::details index.tsx

```tsx: index.tsx
import { signInWithEmailAndPassword, User } from "firebase/auth";
import { useState } from "react";
import { auth } from "../firebase/firebase";

const InputStyle = {
  border: "1px solid white",
  borderRadius: "5px",
  padding: "5px",
  margin: "5px",
  color: "black",
};

const ButtonStyle = {
  border: "4px double white",
  borderRadius: "5px",
  padding: "5px 20px",
  margin: "5px",
};

const Index = () => {
  const [email, setEmail] = useState<string>("");
  const [password, setPassword] = useState<string>("");
  const handleLogin = () => {
    signInWithEmailAndPassword(auth, email, password)
      .then((userCredential) => {
        const user: User = userCredential.user;
        alert("success");
      })
      .catch(() => {
        alert("failed");
      });
  };
  return (
    <div
      style={{
        backgroundColor: "red",
        color: "white",
        height: "100vh",
      }}
    >
      <div
        style={{
          width: "400px",
          margin: "auto",
          paddingTop: "50px",
        }}
      >
        <div
          style={{
            border: "1px solid white",
            borderRadius: "10px",
            padding: "20px",
          }}
        >
          <h1
            style={{
              fontWeight: "bold",
              fontSize: "30px",
            }}
          >
            firebase-jotai
          </h1>
          <div>
            <label>email</label>
            <input
              type="text"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              style={InputStyle}
            />
          </div>
          <div>
            <label
              style={{
                paddingRight: "10px",
              }}
            >
              password
            </label>
            <input
              type="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              style={InputStyle}
            />
          </div>
          <button onClick={handleLogin} style={ButtonStyle}>
            login
          </button>
        </div>
      </div>
    </div>
  );
};

export default Index;
```

:::

å†…å®¹ã¨ã—ã¦ã¯ã€email ã¨ password ã‚’å…¥åŠ›ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€firebase ã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹å‡¦ç†ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚è‡³ã£ã¦ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã€‚

## ãƒ¦ãƒ¼ã‚¶ãƒ¼çŠ¶æ…‹ã®ç®¡ç†

ã„ã‚ˆã„ã‚ˆ jotai ã‚’ä½¿ã£ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼çŠ¶æ…‹ã‚’ç®¡ç†ã—ã¦ã„ãã¾ã™ã€‚
ã¨ã¯è¨€ã£ã¦ã‚‚ã‚„ã‚‹ã“ã¨ã¯ç°¡å˜ã§ã™ã€‚

### 1. jotai ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
yarn add jotai
```

### 2. ãƒ¦ãƒ¼ã‚¶ãƒ¼çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹ atom ã‚’ä½œæˆ

```tsx: user.ts
import type { User } from "firebase/auth";
import { atom } from "jotai";

export const userAtom = atom<User | null>(null);
```

### 3. ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼çŠ¶æ…‹ã‚’æ›´æ–°

```diff tsx: index.tsx
const Index = () => {
  const [email, setEmail] = useState<string>("");
  const [password, setPassword] = useState<string>("");
+ const [user, setUser] = useAtom(userAtom);
  const handleLogin = () => {
    signInWithEmailAndPassword(auth, email, password)
      .then((userCredential) => {
        const user: User = userCredential.user;
+       setUser(user);
        alert("success");
      })
      .catch(() => {
        alert("failed");
      });
  };
  return (
      // çœç•¥
  );
};

export default Index;

```

`const [user, setUser] = useAtom(userAtom);`ã“ã‚Œã ã‘ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### read-only write-only ãª atom ã‚’ä½œæˆ

```tsx: user.ts
import type { User } from "firebase/auth";
import { atom } from "jotai";

export const userAtom = atom<User | null>(null);

// read-only
export const getUserEmailAtom = atom<string | null | undefined>(
  (get) => get(userAtom)?.email
);

// write-only
export const setUserAtom = atom<null, User>(null, (_get, set, update) => {
  set(userAtom, update);
});
```

ä»Šå›ã¯ email ã‚’å–å¾—ã™ã‚‹ atom ã¨ user ã‚’æ›´æ–°ã™ã‚‹ atom ã‚’ä½œæˆã—ã¾ã—ãŸã€‚

å‘¼ã³å‡ºã—æ–¹ã‚‚å°‘ã—å¤‰ã‚ã‚Šã¾ã™ã€‚

:::details index.tsx

```diff tsx:index.tsx
const Index = () => {
  const [email, setEmail] = useState<string>("");
  const [password, setPassword] = useState<string>("");
- const [user, setUser] = useAtom(userAtom);
+ const setUser = useSetAtom(setUserAtom);
+ const userEmail = useAtomValue(getUserEmailAtom);
  const handleLogin = () => {
    signInWithEmailAndPassword(auth, email, password)
      .then((userCredential) => {
        const user: User = userCredential.user;
        setUser(user);
        alert("success");
      })
      .catch(() => {
        alert("failed");
      });
  };
  return (
    <div
      style={{
        backgroundColor: "red",
        color: "white",
        height: "100vh",
      }}
    >
      <div
        style={{
          width: "400px",
          margin: "auto",
          paddingTop: "50px",
        }}
      >
        <div
          style={{
            border: "1px solid white",
            borderRadius: "10px",
            padding: "20px",
          }}
        >
          <h1
            style={{
              fontWeight: "bold",
              fontSize: "30px",
            }}
          >
            firebase-jotai
          </h1>
          <div>
            <label>email</label>
            <input
              type="text"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              style={InputStyle}
            />
          </div>
          <div>
            <label
              style={{
                paddingRight: "10px",
              }}
            >
              password
            </label>
            <input
              type="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              style={InputStyle}
            />
          </div>
          <button onClick={handleLogin} style={ButtonStyle}>
            login
          </button>
+         <p>
+           <span>{userEmail && `welcome ${userEmail} !!!`}</span>
+         </p>
        </div>
      </div>
    </div>
  );
};

export default Index;
```

:::
renad-only ãª atom ã¯ useAtomValue ã§å‘¼ã³å‡ºã—ã€write-only ãª atom ã¯ useSetAtom ã§å‘¼ã³å‡ºã—ã¾ã™ã€‚

ä»Šå›ã¯å†…éƒ¨ãƒ­ã‚¸ãƒƒã‚¯ãŒã»ã¼ã‚ã‚Šã¾ã›ã‚“ãŒã€ã“ã“ã«ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¨˜è¿°ã—ã¦ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå´ã§ã¯ã€å‘¼ã³å‡ºã™ã®ã¿ã«ã™ã‚‹ã¨ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®è¦‹é€šã—ãŒè‰¯ããªã‚Šã¾ã™ã€‚

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®çŠ¶æ…‹ã«ã‚ˆã£ã¦ã€èƒŒæ™¯è‰²ã‚’å¤‰æ›´

æœ€å¾Œã«ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®çŠ¶æ…‹ã«ã‚ˆã£ã¦ã€èƒŒæ™¯è‰²ã‚’å¤‰æ›´ã—ã¦ã¿ã¾ã™ã€‚

```diff ts: user.ts
export const userAtom = atom<User | null>(null);
export const getUserAtom = atom<User | null>((get) => get(userAtom));
export const getUserEmailAtom = atom<string | null | undefined>(
  (get) => get(userAtom)?.email
);
export const setUserAtom = atom<null, User>(null, (_get, set, update) => {
  set(userAtom, update);
+ set(themeAtom, "aquamarine");
});

+ export const themeAtom = atom<"red" | "aquamarine">("red");
+ export const getThemeAtom = atom<"red" | "aquamarine">((get) => + get(themeAtom));
+ export const setThemeAtom = atom<null, "red" | "aquamarine">(
+ null,
+ (_get, set, update) => {
+   set(themeAtom, update);
+ });

```

:::details index.tsx

```diff tsx:index.tsx
import { signInWithEmailAndPassword, User } from "firebase/auth";
import { useAtom, useAtomValue, useSetAtom } from "jotai";
import { useState } from "react";
import { auth } from "../firebase/firebase";
import {
  getUserEmailAtom,
  setUserAtom,
  userAtom,
  getThemeAtom,
} from "../state/user.state";

const InputStyle = {
  border: "1px solid white",
  borderRadius: "5px",
  padding: "5px",
  margin: "5px",
  color: "black",
};

const ButtonStyle = {
  border: "4px double white",
  borderRadius: "5px",
  padding: "5px 20px",
  margin: "5px",
};

const Index = () => {
  const [email, setEmail] = useState<string>("");
  const [password, setPassword] = useState<string>("");
  const setUser = useSetAtom(setUserAtom);
  const userEmail = useAtomValue(getUserEmailAtom);
+ const themeColor = useAtomValue(getThemeAtom);
  const handleLogin = () => {
    signInWithEmailAndPassword(auth, email, password)
      .then((userCredential) => {
        const user: User = userCredential.user;
        setUser(user);
        alert("success");
      })
      .catch(() => {
        alert("failed");
      });
  };
  return (
    <div
      style={{
+       backgroundColor: themeColor,
        color: "white",
        height: "100vh",
      }}
    >
      <div
        style={{
          width: "400px",
          margin: "auto",
          paddingTop: "50px",
        }}
      >
        <div
          style={{
            border: "1px solid white",
            borderRadius: "10px",
            padding: "20px",
          }}
        >
          <h1
            style={{
              fontWeight: "bold",
              fontSize: "30px",
            }}
          >
            firebase-jotai
          </h1>
          <div>
            <label>email</label>
            <input
              type="text"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              style={InputStyle}
            />
          </div>
          <div>
            <label
              style={{
                paddingRight: "10px",
              }}
            >
              password
            </label>
            <input
              type="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              style={InputStyle}
            />
          </div>
          <button onClick={handleLogin} style={ButtonStyle}>
            login
          </button>
          <p>
            <span>{userEmail && `welcome ${userEmail} !!!`}</span>
          </p>
        </div>
      </div>
    </div>
  );
};

export default Index;

```

:::

å‹•ä½œã®æµã‚Œã¨ã—ã¦ã¯

1. ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™
2. ãƒ­ã‚°ã‚¤ãƒ³ã«æˆåŠŸã—ãŸã‚‰ã€`setUserAtom` ãŒå‘¼ã³å‡ºã•ã‚Œã‚‹
3. `setUserAtom` å†…ã§`setThemeAtom` ãŒå®Ÿè¡Œã€`themeAtom` ãŒæ›´æ–°ã•ã‚Œã‚‹ã€‚
4. `themeAtom` ãŒæ›´æ–°ã•ã‚Œã‚‹ã¨ã€`getThemeAtom` ã«ã‚ˆã£ã¦èƒŒæ™¯è‰²ãŒå¤‰æ›´ã•ã‚Œã‚‹

![ãƒ­ã‚°ã‚¢ã‚¦ãƒˆçŠ¶æ…‹](/images/jotai-firebase/loginUI.png)

### ã¾ã¨ã‚

jotai ã¨ firebase ã‚’çµ„ã¿åˆã‚ã›ã¦ã€ç°¡å˜ãªãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚ä»Šå›ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã®å®Ÿè£…ã‚’ã—ã¾ã›ã‚“ã§ã—ãŸãŒã€ã»ã¼åŒã˜ã‚ˆã†ã«å®Ÿè£…ã§ãã‚‹ã®ã§ã‚„ã£ã¦ã¿ã¦ãã ã•ã„ï¼

### å‚è€ƒ

https://jotai.org/

### æœ€å¾Œã«

Gohan DAO ã¯ã€ã¾ã£ãŸã‚Šå€‹äºº/å…±åŒé–‹ç™ºã—ã¦ã„ã‚‹ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã§ã™ã€‚
å€‹äººé–‹ç™ºã—ã¦ã‚‹ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚’å…±æœ‰ã—ã¦ä¸€ç·’ã«æ”¹å–„ã—ãŸã‚Šã€æŠ€è¡“ã¾ã‚ã‚Šã®æ¤œè¨¼ãªã©è¡Œã£ã¦ã„ã‘ãŸã‚‰ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚
â€»DAO åŒ–ã—ã¦ã¿ãŸã„ãŒ DAO ã§ã¯ãªã„

Discord ã«ãœã²ã”å‚åŠ ãã ã•ã„ã€‚
https://discord.gg/C8h6PpMTmg
é€± 1 ãƒšãƒ¼ã‚¹ã§ MTG ã—ã¦ã„ã¾ã™ã€‚èˆˆå‘³æœ¬ä½ã§ãŠæ°—è»½ã«ã©ã†ãï¼
â€»ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§ãªã„æ–¹ã‚‚æ­“è¿ã§ã™ã€‚

ç¾åœ¨é–‹ç™ºä¸­ã®ã‚¢ãƒ—ãƒª: https://nftotaku.xyz/  
github ãƒ¬ãƒã‚¸ãƒˆãƒª: https://github.com/gohandao
